name: NET with Tolerance
description: |

# 20211129_043300000_03-invoices.csv
#
# "Invoice No","Ref","Invoice Date","Amount"
# "ST","ST","DA","DE"
# "0001","INV0001","1637814968000","1050.99"
# "0002","INV0002","1637901368000","500.00"

# 20211129_043300000_03-payments.csv
#
# "PaymentId","Ref","Amount","Payment Date"
# "ST","ST","DE","DA"
# "P1","INV0001","50.00","1637987768000"
# "P2","INV0002","500.00","1637987768000"
# "P1","INV0001","1000.00","1638074168000"

version: 1
file_patterns: ['.*03-invoices\.csv', '.*03-payments\.csv']
field_aliases: ['INV', 'PAY']
debug: true
instructions:
  - merge_columns:
      from: ['INV.Amount', 'PAY.Amount']
      into: AMOUNT
  - merge_columns:
      from: ['INV.Ref', 'PAY.Ref']
      into: REF
  - match_groups:
      group_by: ['REF']
      constraints:
        - nets_with_tolerance:
            column: AMOUNT
            lhs: record["META.prefix"] == "INV"
            rhs: record["META.prefix"] == "PAY"
            tol_type: Amount
            tolerance: 1.00
            # tol_type can also be Percent. In whice case the rhs sum must be with in
            # x percent of the lhs sum where x is the tolerance value. so 10.0 for 10%.
