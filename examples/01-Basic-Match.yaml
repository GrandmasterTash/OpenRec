name: Basic Match
description: |
  This charter demonstrates how to set-up a basic match between a single invoice and one or more payments
  for that invoice. There no complexities in this match, a unique reference ('Ref') is present for both sets
  of data.

  TODO: Document qualified field names and how data is loaded into memory.

# TODO: Document that all waiting files must have a particular file format.
# TODO: Document that fields are case-sensitive.

version: 1
file_patterns: ['.*01-invoices\.csv', '.*01-payments\.csv']
debug: true
instructions:
  - merge_columns:
      from: ['01-invoices.Amount', '01-payments.Amount']
      into: AMOUNT
  - merge_columns:
      from: ['01-invoices.Ref', '01-payments.Ref']
      into: REF
  - match_groups:
      group_by: ['REF']
      constraints:
        - nets_to_zero:
            column: AMOUNT
            # TODO: Don't use META in first example.
            lhs: record["META.prefix"] == "01-payments"
            rhs: record["META.prefix"] == "01-invoices"
